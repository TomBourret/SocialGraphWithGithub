<!DOCTYPE html>

<html>
    <head>
        <title>GitHub API Visualisation</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="style.css" />
        <script src="https://code.jquery.com/jquery.min.js"></script>
    </head>
    <body>
		<h1> Authenticate and retrieve datas</h1>
		<form>
			Username<br>
			<input type="text" id="formUsername">
			<br>
			Password<br>
			<input type="password" id="formPassword">
			<input type="button" id="authenticateSubmit" value="Authenticate">
		</form>
		
		<h2>Just retrieve public datas</h2>
		Username<br>
		<input type="text" id='GHusername' rows="1">
        <button onclick="askGitHubAPI()">Call the API with this username</button>
        
		<h3>Results appear here</h3>
		<div id='userDatas' style="width:450px;">
            <span>Enter an existing username</span>
        </div>

        <script>
		
			function dumpResponse() {
				$('#userDatas').html(createTableFromJson(this.responseText));
			}

			function createTableFromJson(jsonString) {
				var dataTable = '<table><tr><th>Key</th><th>Value</th>';
				var datas = JSON.parse(jsonString);
				for (var key in datas){
					var value = datas[key];
					dataTable += '<tr><th>' + key + '</th><th>' + transformStringToHyperlink(value) + '</th></tr>';
				}
				dataTable += '</table>';
				return dataTable;
			}
			
			function transformStringToHyperlink(stringToHyperlink) {
				if(String(stringToHyperlink).startsWith("https://")){
					return ('<a href="' + stringToHyperlink + '" target="_blank">' + stringToHyperlink + '</a>');
				}
				else {
					return stringToHyperlink;
				}
			}
			
            function askGitHubAPI() {
				// Create a new request object
				var request = new XMLHttpRequest();
				
				request.onload = dumpResponse;
				// Initialize a request
				request.open('get', 'https://api.github.com/users/' + document.getElementById("GHusername").value);
				// Send it
				request.send();

			}
			
			$('#authenticateSubmit').click(function(){
				var usernameAndPassword = $("#formUsername").val() + ":" + $("#formPassword").val();
				$.ajax({
					url: "https://api.github.com/user",
					beforeSend: function(xhr) { 
					  xhr.setRequestHeader("Authorization", "Basic " + btoa(usernameAndPassword)); 
					},
					type: 'GET',
					dataType: 'json',
					contentType: 'application/json',
					success: function (data) {
					  $('#userDatas').html(createTableFromJson(JSON.stringify(data)));
					},
					error: function(){
					  $('#userDatas').html("Your identifiers are uncorrect");
					}
				});
			});
        </script>
        
    </body>
</html>

